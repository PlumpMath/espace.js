/*! espace 2014-08-31; Copyright 2014 Adrian Toncean; released under the MIT license */
!function(){"use strict";function a(a,b){function c(a,b){if("("===b.token.type){if("("!==a.token.type||a.tree.length!==b.tree.length)return!1;if(a.tree.length!==b.tree.length)return!1;if("alphanum"!==a.tree[0].token.type||a.tree[0].token.value!==b.tree[0].token.value)return!1;for(var e=1;e<b.tree.length;e++)if(!c(a.tree[e],b.tree[e]))return!1;return!0}return d[b.token.value]=a,!0}var d={};return c(a,b,d)?d:null}function b(a){var c={token:{type:a.token.type}};return a.token.hasOwnProperty("value")&&(c.token.value=a.token.value),"("===a.token.type&&(c.tree=a.tree.map(function(a){return b(a)})),c}function c(a,b){function c(a){if("alphanum"===a.token.type){if(b[a.token.value]){var d=b[a.token.value];a.token=d.token,"("===d.token.type&&(a.tree=d.tree)}}else"("===a.token.type&&a.tree.forEach(c)}c(a)}var d={};d.extract=a,d.deepClone=b,d.inject=c,d.expand=function(d,e,f){function g(d){var h=a(d,e);if(h){var i=b(f);c(i,h),d.token=i.token,d.tree=i.tree}"("===d.token.type&&d.tree.forEach(g)}g(d)},window.espace=window.espace||{},window.espace.Expander=d}(),function(){"use strict";function a(a,b){var c=new Error(b);throw c.coords=a.coords,c}var b={};b.parse=function(b){if(!b.length)return null;var c,d=[],e=null,f=b[0];if("("===f.type)e={token:f,tree:[]},c=e,d.push(e);else{if(")"!==f.type)return b.length>1&&a(f,"Unexpected token"),c={token:f};a(f,"Cannot start with )")}for(var g=1;g<b.length;g++)if(f=b[g],e||a(f,"Unexpected token"),"("===f.type){var h={token:f,tree:[]};e.tree.push(h),e=h,d.push(e)}else")"===f.type?(d.pop(),e=d[d.length-1]):e.tree.push({token:f});return d.length&&a(f,"Missing )"),c},window.espace=window.espace||{},window.espace.Parser=b}(),function(){"use strict";var a={};a.serialize=function(b){if(!b)return"";switch(b.token.type){case"string":return'"'+b.token.value+'"';case"number":return""+b.token.value;case"alphanum":return b.token.value;case"(":return"("+b.tree.map(function(b){return a.serialize(b)}).join(" ")+")"}},window.espace=window.espace||{},window.espace.Serializer=a}(),function(){"use strict";function a(a){this.string=a,this.pointer=0,this.marker=0,this.line=1,this.column=1}a.prototype.advance=function(){"\n"===this.current()?(this.line++,this.column=1):this.column++,this.pointer++},a.prototype.setMarker=function(a){a=a||0,this.marker=this.pointer+a},a.prototype.current=function(){return this.string.charAt(this.pointer)},a.prototype.next=function(){return this.string.charAt(this.pointer+1)},a.prototype.hasNext=function(){return this.pointer<this.string.length},a.prototype.getMarked=function(a){return a=a||0,this.string.substring(this.marker,this.pointer+a)},a.prototype.getCoords=function(){return{line:this.line,column:this.column}},window.espace=window.espace||{},window.espace.IterableString=a}(),function(){"use strict";function a(a,b){var c=new Error(b);throw c.coords=a,c}function b(b){function c(b){var c=[];for(b.advance();;){if("\\"===b.current())b.advance(),o[b.current()]&&c.push(o[b.current()]);else{if("'"===b.current())return b.advance(),j("string",c.join(""),b.getCoords());"\n"!==b.current()&&b.hasNext()?c.push(b.current()):a(b.getCoords(),"String not properly ended")}b.advance()}}function d(b){var c=[];for(b.advance();;){if("\\"===b.current())b.advance(),o[b.current()]&&c.push(o[b.current()]);else{if('"'===b.current())return b.advance(),j("string",c.join(""),b.getCoords());"\n"!==b.current()&&b.hasNext()?c.push(b.current()):a(b.getCoords(),"String not properly ended")}b.advance()}}function e(b){b.setMarker();for(var c=b.current();c>="0"&&"9">=c;)b.advance(),c=b.current();if("."==b.current()){b.advance();for(var c=b.current();c>="0"&&"9">=c;)b.advance(),c=b.current()}return-1===") \n	".indexOf(b.current())&&a(b.getCoords(),"Unexpected character '"+b.current()+"' after '"+b.getMarked()+"'"),j("number",+b.getMarked(),b.getCoords())}function f(b){for(b.setMarker(2),b.advance(),b.advance();;){if("-"===b.current()&&";"===b.next())return b.advance(),b.advance(),j("comment",b.getMarked(-2),b.getCoords());b.hasNext()?b.advance():a(b.getCoords(),"Multiline comment not properly terminated")}}function g(a){for(a.setMarker(1),a.advance();;){if("\n"===a.current()||!a.hasNext())return a.advance(),j("comment",a.getMarked(),a.getCoords());a.advance()}}function h(a){a.setMarker();for(var b=a.current();b>" "&&"~">=b&&"("!=b&&")"!=b;)a.advance(),b=a.current();return j("alphanum",a.getMarked(),a.getCoords())}function i(a){var b=a.current();return a.advance(),j("whitespace",b,a.getCoords())}b=b||{};var j,k,l=!!b.whitespace,m=!!b.comments,n=!!b.coords;n?(j=function(a,b,c){return{type:a,value:b,coords:c}},k=function(a,b){return{type:a,coords:b}}):(j=function(a,b){return{type:a,value:b}},k=function(a){return{type:a}});var o={"\\":"\\",n:"\n",t:"	","'":"'",'"':'"'};return function(a){for(var b=new espace.IterableString(a),j=[];b.hasNext();){var n=b.current();if("'"===n)j.push(c(b));else if('"'===n)j.push(d(b));else if(";"===n){var o=b.next();if("-"===o){var p=f(b);m&&j.push(p)}else{var p=g(b);m&&j.push(p)}}else if(n>="0"&&"9">=n)j.push(e(b));else if("("===n)j.push(k("(",b.getCoords())),b.advance();else if(")"===n)j.push(k(")",b.getCoords())),b.advance();else if(n>" "&&"~">=n)j.push(h(b));else{var p=i(b);l&&j.push(p)}}return j}}window.espace=window.espace||{},window.espace.Tokenizer=b}();